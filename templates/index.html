<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Barbearia Fio de Ouro - Início</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <header>
        <div class="logo">
            <h1>FIO DE OURO</h1>
        </div>
        <nav>
            <ul>
                <li><a href="index.html">Início</a></li>
                <li><a href="agendamento.html">Agendar</a></li>
                <li id="login-link"><a href="login.html">Login</a></li>
                <li><a href="barbeiro.html">Área Barbeiro</a></li>
                <li id="logout-link" style="display: none;"><a href="#" id="logout-btn">Logout</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <section class="hero">
            <h2><i class="fas fa-cut"></i> Bem-vindo à Barbearia Fio de Ouro</h2>
            <p>Agende seu corte com os melhores barbeiros da cidade. Estilo, precisão e atendimento de primeira.</p>
            <a href="agendamento.html" class="btn-agendar">Agendar Agora <i class="fas fa-calendar-check"></i></a>
        </section>

        <section class="barbeiros">
            <h2><i class="fas fa-users"></i> Nossos Barbeiros</h2>
            <div id="barbeiros-list" class="barbeiros-grid">
                <!-- Barbeiros serão carregados aqui -->
            </div>
        </section>

        <section class="horarios">
            <h2><i class="fas fa-clock"></i> Horários Disponíveis</h2>
            <div id="horarios-list" class="horarios-grid">
                <!-- Horários serão carregados aqui -->
            </div>
            <a href="agendamento.html" class="btn-agendar">Agendar Agora <i class="fas fa-arrow-right"></i></a>
        </section>

        <section class="galeria">
            <h2><i class="fas fa-images"></i> Nossa Galeria</h2>
            <div class="galeria-grid">
                <div class="galeria-item">
                    <img src="https://images.unsplash.com/photo-1503951914875-452162b0f3f1?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80" alt="Corte moderno">
                    <div class="overlay">
                        <h4>Corte Moderno</h4>
                        <p>Estilos contemporâneos para o homem moderno</p>
                    </div>
                </div>
                <div class="galeria-item">
                    <img src="https://images.unsplash.com/photo-1621605815971-fbc98d665033?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2071&q=80" alt="Barba bem feita">
                    <div class="overlay">
                        <h4>Barba Perfeita</h4>
                        <p>Contornos precisos e acabamento impecável</p>
                    </div>
                </div>
                <div class="galeria-item">
                    <img src="https://images.unsplash.com/photo-1585747860715-2ba37e788b70?ixlib=rb-4.0.3&auto=format&fit=crop&w=2074&q=80" alt="Ambiente acolhedor">
                    <div class="overlay">
                        <h4>Ambiente Acolhedor</h4>
                        <p>Espaço confortável para seu momento de relaxamento</p>
                    </div>
                </div>
            </div>
        </section>

        <section class="depoimentos">
            <h2><i class="fas fa-star"></i> Depoimentos</h2>
            <div class="depoimentos-grid">
                <div class="depoimento-card">
                    <p>"Excelente atendimento! Os barbeiros são profissionais e o resultado sempre fica perfeito. Recomendo!"</p>
                    <div class="autor">- João Silva</div>
                </div>
                <div class="depoimento-card">
                    <p>"Ambiente agradável e preços justos. Sempre saio satisfeito com meu corte e barba."</p>
                    <div class="autor">- Carlos Santos</div>
                </div>
                <div class="depoimento-card">
                    <p>"Melhor barbearia da cidade! Atendimento rápido, profissionais qualificados e muito cuidado."</p>
                    <div class="autor">- Roberto Lima</div>
                </div>
            </div>
        </section>

        <section class="meus-agendamentos">
            <h2><i class="fas fa-calendar-alt"></i> Meus Agendamentos</h2>
            <div id="agendamentos-list">
                <!-- Agendamentos serão carregados aqui -->
            </div>
        </section>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // Initialize Supabase client
        const supabaseUrl = 'https://gruzcdrzryuiahiwwalc.supabase.co'; // Your Supabase Project URL
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdydXpjZHJ6cnl1aWFoaXd3YWxjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjEyMjAzMTcsImV4cCI6MjA3Njc5NjMxN30.C_qa-brDL4HQE0bMmvnNBYsdnn1J8_eV_aneHNTSE0g'; // Your anon public key
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

        // Check auth state on page load
        supabase.auth.onAuthStateChange((event, session) => {
            if (session) {
                // User is logged in
                document.getElementById('login-link').style.display = 'none';
                document.getElementById('logout-link').style.display = 'block';
                document.getElementById('logout-btn').addEventListener('click', async () => {
                    await supabase.auth.signOut();
                    location.reload();
                });
                loadUserData(session.user);
            } else {
                // User is not logged in
                document.getElementById('login-link').style.display = 'block';
                document.getElementById('logout-link').style.display = 'none';
            }
        });

        async function loadUserData(user) {
            // Load appointments for logged-in user
            try {
                const { data: appointments } = await supabase
                    .from('appointments')
                    .select('*, barbers!inner(nome)')
                    .eq('usuario_email', user.email)
                    .order('data', { ascending: false });
                const agendamentosList = document.getElementById('agendamentos-list');
                if (appointments.length > 0) {
                    appointments.forEach(agendamento => {
                        const div = document.createElement('div');
                        div.className = 'agendamento-item';
                        div.innerHTML = `
                            <p><strong>Serviço:</strong> ${agendamento.servico}</p>
                            <p><strong>Barbeiro:</strong> ${agendamento.barbers.nome}</p>
                            <p><strong>Data:</strong> ${agendamento.data}</p>
                            <p><strong>Hora:</strong> ${agendamento.hora}</p>
                        `;
                        agendamentosList.appendChild(div);
                    });
                } else {
                    agendamentosList.innerHTML = '<p>Nenhum agendamento encontrado.</p>';
                }
            } catch (error) {
                console.error('Erro ao carregar agendamentos:', error);
            }
        }
    </script>
    <script src="/app.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            // Carregar barbeiros
            try {
                const response = await fetch('/barbeiros');
                const barbeiros = await response.json();
                const barbeirosList = document.getElementById('barbeiros-list');
                barbeiros.forEach(barbeiro => {
                    const div = document.createElement('div');
                    div.className = 'barbeiro-card';
                    div.innerHTML = `
                        <h3>${barbeiro.nome}</h3>
                        <p>${barbeiro.especialidade}</p>
                        <a href="agendamento.html?barbeiro=${encodeURIComponent(barbeiro.email)}" class="btn-agendar">Agendar</a>
                    `;
                    barbeirosList.appendChild(div);
                });
            } catch (error) {
                console.error('Erro ao carregar barbeiros:', error);
            }

            // Carregar horários
            try {
                const response = await fetch('/horarios');
                const horarios = await response.json();
                const horariosList = document.getElementById('horarios-list');
                horarios.forEach(horario => {
                    const div = document.createElement('div');
                    div.className = 'horario-item';
                    div.textContent = horario;
                    horariosList.appendChild(div);
                });
            } catch (error) {
                console.error('Erro ao carregar horários:', error);
            }

            // Verificar login e ajustar navegação
            const usuarioLogado = JSON.parse(localStorage.getItem('usuarioLogado'));
            if (usuarioLogado) {
                document.getElementById('login-link').style.display = 'none';
                document.getElementById('logout-link').style.display = 'block';
                document.getElementById('logout-btn').addEventListener('click', () => {
                    localStorage.removeItem('usuarioLogado');
                    location.reload();
                });
            }

            // Carregar agendamentos do usuário logado
            if (usuarioLogado) {
                try {
                    const response = await fetch(`/appointments/${usuarioLogado.email}`);
                    const agendamentos = await response.json();
                    const agendamentosList = document.getElementById('agendamentos-list');
                    if (agendamentos.length > 0) {
                        agendamentos.forEach(agendamento => {
                            const div = document.createElement('div');
                            div.className = 'agendamento-item';
                            div.innerHTML = `
                                <p><strong>Serviço:</strong> ${agendamento.servico}</p>
                                <p><strong>Barbeiro:</strong> ${agendamento.barbeiro_nome}</p>
                                <p><strong>Data:</strong> ${agendamento.data}</p>
                                <p><strong>Hora:</strong> ${agendamento.hora}</p>
                                ${agendamento.status === 'cancelado' ? `<p><strong>Status:</strong> Cancelado - ${agendamento.motivo_cancelamento}</p>` : ''}
                            `;
                            agendamentosList.appendChild(div);
                        });
                    } else {
                        agendamentosList.innerHTML = '<p>Nenhum agendamento encontrado.</p>';
                    }
                } catch (error) {
                    console.error('Erro ao carregar agendamentos:', error);
                }
            } else {
                document.getElementById('agendamentos-list').innerHTML = '<p>Faça login para ver seus agendamentos.</p>';
            }
        });
    </script>

    <footer>
        <p>&copy; 2024 Barbearia Fio de Ouro. Todos os direitos reservados.</p>
    </footer>
</body>
</html>
